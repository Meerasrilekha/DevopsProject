<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>Admin Dashboard</title>
</head>
<body>
    <header class="d-flex justify-content-between align-items-center p-3 bg-light">
        <i class='bx bx-menu' id="menu-icon"></i>
        <div class="logo">
            <a href="#Home"><img src="Frame 29.png" alt="Logo"></a>
        </div>
        <ul class="navbar nav">
            <li class="nav-item"><a class="nav-link" href="Chooseyourservice.html">Service Requests</a></li>
            <li class="nav-item"><a class="nav-link" href="solarcalculatorform.html">Solar Data</a></li>
            <li class="nav-item"><a class="nav-link" href="clientcallback.html">Communication Requests</a></li>
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        </ul>
    </header>

    <section class="notifications" id="notifications">
        <h2 class="pt-4">Notifications</h2>
        <ul id="notification-list" class="list-unstyled pl-3"></ul>
    </section>

    <section class="solar-data mt-4" id="solar-data">
        <h2>Solar Data</h2>
        <div class="form-inline mb-3">
            <label for="date-input" class="mr-2">Select Date:</label>
            <input type="date" id="date-input" name="date-input" class="form-control mr-2">
            <button onclick="fetchSolarData()" class="btn btn-primary">Fetch Data</button>
        </div>
        <table class="table table-bordered" id="solar-data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Service Type</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>

    <script>
        // Fetch notifications and display them
        async function fetchNotifications() {
            try {
                const response = await fetch('/notifications'); // Replace with correct server route
                const data = await response.json();
                if (data.success) {
                    const notificationList = document.getElementById('notification-list');
                    notificationList.innerHTML = '';
                    data.notifications.forEach(notification => {
                        const li = document.createElement('li');
                        li.classList.add('mb-2');
                        li.textContent = `${notification.message} (${new Date(notification.created_at).toLocaleString()})`;
                        notificationList.appendChild(li);
                    });
                } else {
                    console.error(data.error);
                }
            } catch (error) {
                console.error('Error fetching notifications:', error);
            }
        }

        // Fetch solar data for the selected date
        async function fetchSolarData() {
            const dateInput = document.getElementById('date-input').value;
            if (!dateInput) {
                alert('Please select a date.');
                return;
            }

            try {
                const response = await fetch(`/fetch-solar-data?date=${dateInput}`);
                const data = await response.json();
                if (Array.isArray(data)) {
                    populateSolarTable(data);
                } else {
                    console.error("Data format error:", data);
                }
            } catch (error) {
                console.error('Error fetching solar data:', error);
            }
        }

        // Populate solar data table
        function populateSolarTable(data) {
            const solarDataTable = document.getElementById('solar-data-table').getElementsByTagName('tbody')[0];
            solarDataTable.innerHTML = '';
            data.forEach(item => {
                const row = solarDataTable.insertRow();
                row.insertCell(0).innerText = item.id;
                row.insertCell(1).innerText = item.serviceType || 'N/A';
                row.insertCell(2).innerText = item.formatted_timestamp || 'N/A'; // Include formatted timestamp
            });
        }

        // Initialize notifications on page load
        document.addEventListener('DOMContentLoaded', fetchNotifications);
    </script>
</body>
</html>
